{"remainingRequest":"D:\\GaeaProject\\jpn_medical_web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\GaeaProject\\jpn_medical_web\\pages\\common\\room.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\GaeaProject\\jpn_medical_web\\pages\\common\\room.vue","mtime":1591969351743},{"path":"D:\\GaeaProject\\jpn_medical_web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\GaeaProject\\jpn_medical_web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\GaeaProject\\jpn_medical_web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\GaeaProject\\jpn_medical_web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB2aWRlb0VsZW1lbnQgZnJvbSAnQC9wYWdlcy9jb21tb24vdmlkZW9FbGVtZW50LnZ1ZScKaW1wb3J0IE5vdGljZVNESyBmcm9tICdAL3V0aWxzL25vdGljZVNESy9pbmRleC5qcycKaW1wb3J0IFJ0Y1NESyBmcm9tICdAL3V0aWxzL3J0Y1NESy9ydGMuanMnCmltcG9ydCBjb25mIGZyb20gJ0AvY29uZi9jb25mLmpzJwppbXBvcnQge21ha2VHdWlkfSBmcm9tICcuLi8uLi9zcmMvdXRpbHMvbWFrZUd1aWQuanMnOwppbXBvcnQge21hcFN0YXRlLG1hcE11dGF0aW9uc30gZnJvbSAndnVleCcKaW1wb3J0IG5vdGljZSBmcm9tICdAL3V0aWxzL21peGlucy9ub3RpY2UuanMnCgpleHBvcnQgZGVmYXVsdCB7Cgljb21wdXRlZDogewoJCS4uLm1hcFN0YXRlKFsidUluZm8iXSksCgkJLi4ubWFwU3RhdGUoWyJub3RpY2VSb29tIl0pLAoJfSwKCW1peGluczpbbm90aWNlXSwKCWRhdGEoKXsKCQlyZXR1cm4gewoJCQl1c2VyU3RyZWFtczp7fSwKCQkJdXNlclJ0Y3M6e30sCgkJfQoJfSwKCW1ldGhvZHM6ewoJCWNoZWNrTWVkaWEoKXsKCQkJcmV0dXJuIHsKCQkJCW1lZGlhRGV2aWNlczpuYXZpZ2F0b3IgIT0gdW5kZWZpbmVkICYmIG5hdmlnYXRvci5tZWRpYURldmljZXMgIT0gdW5kZWZpbmVkLAoJCQl9CgkJfSwKCQlhc3luYyBjcmVhdGVMb2NhbFN0ZWFtKCkgewoJCQlpZiAoIXRoaXMuY2hlY2tNZWRpYSgpLm1lZGlhRGV2aWNlcykgewoJCQkJcmV0dXJuCgkJCX0KCQkJcmV0dXJuIGF3YWl0IG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKHsKCQkJCWF1ZGlvOiB0cnVlLAoJCQkJdmlkZW86IHsKCQkJCQl3aWR0aDogewoJCQkJCQlpZGVhbDogMTI4MAoJCQkJCX0sCgkJCQkJaGVpZ2h0OiB7CgkJCQkJCWlkZWFsOiA3MjAKCQkJCQl9CgkJCQl9CgkJCX0pOwoJCX0sCgkJYXN5bmMgY3JlYXRlUnRjU2VuZGVyKHVpZCwgdHlwZSkgewoJCQlsZXQgdGhhdCA9IHRoaXM7CgkJCWxldCBydGMgPSBuZXcgUnRjU0RLKHsKCQkJCXNlcnZlOiAic3R1bjpzdHVuLnN0dW5wcm90b2NvbC5vcmc6MzQ3OCIKCQkJfSk7CgkJCS8vcnRjLnNlbmRPZmZlciA9IGZhbHNlOwoJCQlpZiAodGhpcy5jaGVja01lZGlhKCkubWVkaWFEZXZpY2VzKSB7CgkJCQkvL+a4heepuuWGheWuuQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvY2FsU3RyZWFtJykuaW5uZXJIVE1MID0gIiI7CgkJCQkKCQkJCWxldCBzdHJlYW0gPSBhd2FpdCB0aGlzLmNyZWF0ZUxvY2FsU3RlYW0oKTsKCQkJCWNvbnN0IHZpZGVvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndmlkZW8nKTsKCQkJCXZpZGVvLndpZHRoID0gMzAwOwoJCQkJdmlkZW8uaGVpZ2h0ID0gMzAwOwoJCQkJdmlkZW8uYXV0b3BsYXkgPSB0cnVlOwoJCQkJdmlkZW8ucGxheXNpbmxpbmUgPSB0cnVlOwoJCQkJdmlkZW8uY29udHJvbHMgPSB0cnVlOwoJCQkJdmlkZW8uc3JjT2JqZWN0ID0gc3RyZWFtOwoJCQkJbGV0IHBhcmVudEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibG9jYWxTdHJlYW0iKTsKCQkJCXBhcmVudEVsZW1lbnQuYXBwZW5kQ2hpbGQodmlkZW8pOwoJCQkJCgkJCQlydGMuYWRkU3RlYW0oc3RyZWFtKTsKCQkJfQoJCQoJCQlydGMuam9pbiA9IChzdHJlYW0pID0+IHsKCQkJCXRoaXMuJHNldCh0aGF0LnVzZXJTdHJlYW1zLCB1aWQsIHN0cmVhbS5zdHJlYW0pCgkJCX0KCQkJdGhpcy5zZXRVc2VyUnRjcyhydGMsIHVpZCwgdHlwZSk7CgkJCXJldHVybiBhd2FpdCBydGMuY3JlYXRlT2ZmZXIoewoJCQkJb2ZmZXJUb1JlY2VpdmVWaWRlbzogdHJ1ZSwKCQkJCW9mZmVyVG9SZWNlaXZlQXVkaW86IHRydWUKCQkJfSk7CgkJfSwKCQlzZXRVc2VyUnRjcyhydGMsdWlkLHR5cGUpewoJCQlpZighdGhpcy51c2VyUnRjc1t1aWRdKXsKCQkJCXRoaXMudXNlclJ0Y3NbdWlkXSA9IG5ldyBPYmplY3QoKTsKCQkJfQoJCQl0aGlzLnVzZXJSdGNzW3VpZF1bdHlwZV0gPSBydGM7CQoJCX0sCgkJY3JlYXRlUm9vbShpbmZvKXsKCQkJLypsZXQgb2ZmZXIgPSB0aGlzLmNyZWF0ZVJ0Y1NlbmRlcihpbmZvLkRhdGEuQWNjZXB0Lkd1aWQsJ2Rlc2snKTsKCQkJbGV0IHJ0YyA9IHRoaXMudXNlclJ0Y3NbaW5mby5EYXRhLkFjY2VwdC5HdWlkXS5kZXNrOwoJCQlydGMucmVhZHkgPSAodG9rZW4pPT57CgkJCQlsZXQgc2VuZE1zZyA9IHsKCQkJCQl0eXBlOidwdXNoJywKCQkJCQlqc2VwOm9mZmVyLAoJCQkJCXRva2VuOnJ0Yy5jYW5kaWRhdGUKCQkJCX0KCQkJCXRoaXMubm90aWNlUm9vbS5zZW5kKGluZm8uRGF0YS5BY2NlcHQuR3VpZCwgc2VuZE1zZyk7CgkJCX0qLwoJCQl0aGlzLmluaXRSb29tKGluZm8pOwoJCX0sCgkJYXN5bmMgY3JlYXRlUnRjUmV2aWNlKHVpZCx0eXBlKXsKCQkJbGV0IHRoYXQgPSB0aGlzOwoJCQlsZXQgcnRjID0gbmV3IFJ0Y1NESyh7c2VydmU6InN0dW46c3R1bi5zdHVucHJvdG9jb2wub3JnOjM0NzgifSk7CgkJCS8vcnRjLnNvY3VyZS5hZGRUcmFuc2NlaXZlcignYXVkaW8nLCB7ICdkaXJlY3Rpb24nOiAncmVjdm9ubHknIH0pOwoJCQkvL3J0Yy5zb2N1cmUuYWRkVHJhbnNjZWl2ZXIoJ3ZpZGVvJywgeyAnZGlyZWN0aW9uJzogJ3JlY3Zvbmx5JyB9KTsKCQkJLy9ydGMuc2VuZE9mZmVyID0gZmFsc2U7CgkJCWlmKHRoaXMuY2hlY2tNZWRpYSgpLm1lZGlhRGV2aWNlcyl7CgkJCQkvL+a4heepuuWGheWuuQoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvY2FsU3RyZWFtJykuaW5uZXJIVE1MID0gIiI7CgkJCQkKCQkJCWxldCBzdHJlYW0gPSBhd2FpdCB0aGlzLmNyZWF0ZUxvY2FsU3RlYW0oKTsKCQkJCWNvbnN0IHZpZGVvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndmlkZW8nKTsKCQkJCXZpZGVvLndpZHRoID0gMzAwOwoJCQkJdmlkZW8uaGVpZ2h0ID0gMzAwOwoJCQkJdmlkZW8uYXV0b3BsYXkgPSB0cnVlOwoJCQkJdmlkZW8ucGxheXNpbmxpbmUgPSB0cnVlOwoJCQkJdmlkZW8uY29udHJvbHMgPSBmYWxzZTsKCQkJCXZpZGVvLnNyY09iamVjdCA9IHN0cmVhbTsKCQkJCWxldCBwYXJlbnRFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxvY2FsU3RyZWFtIik7CgkJCQlwYXJlbnRFbGVtZW50LmFwcGVuZENoaWxkKHZpZGVvKTsKCQkJCXJ0Yy5hZGRTdGVhbShzdHJlYW0pOwoJCQl9CgkJCQkJCQoJCQlydGMuam9pbj0oc3RyZWFtKT0+ewoJCQkJY29uc29sZS5sb2coImluIGpvaW4iLHN0cmVhbSkKCQkJCXRoaXMuJHNldCh0aGF0LnVzZXJTdHJlYW1zLHVpZCxzdHJlYW0uc3RyZWFtKQoJCQkJLy90aGF0LnVzZXJTdHJlYW1zW3VpZF09c3RyZWFtLnN0cmVhbTsKCQkJCWNvbnNvbGUubG9nKCJ0aGF0Iix0aGF0LnVzZXJTdHJlYW1zKQoJCQl9CgkJCXRoaXMuc2V0VXNlclJ0Y3MocnRjLHVpZCx0eXBlKTsJCQoJCQlyZXR1cm4gYXdhaXQgcnRjOwoJCQkvL3JldHVybiBhd2FpdCBydGMuY3JlYXRlT2ZmZXIoeyBvZmZlclRvUmVjZWl2ZVZpZGVvOiB0cnVlLCBvZmZlclRvUmVjZWl2ZUF1ZGlvOiB0cnVlIH0pOwoJCX0sCgkJZXZlbnMoKXsKCQkJLy/lvZPlr7nmlrnpgInmi6nku6Xop4bpopHmlrnlvI/mjqXpgJrml7YKCQkJdGhpcy4kZXZlbi4kb24oIm5vdGljZV9saXZlX2Nvbm5lY3RhbGwiLChpbmZvKT0+ewoJCQkJLy/lvZPliY3nlKjmiLflt7LlnKjmiL/pl7QKCQkJCWlmKHRoaXMubm90aWNlUm9vbS5pbmZvICE9IHVuZGVmaW5lZCl7CgkJCQkJdmFyIG1zZyA9IHsKCQkJCQkJdG86IGluZm8uRnJvbS5HdWlkLAoJCQkJCQlpbmZvOiB7CgkJCQkJCQlQbGF0ZTogdGhpcy5ub3RpY2VSb29tLmluZm8ucGxhdGUsCgkJCQkJCQlDb2RlOiB0aGlzLm5vdGljZVJvb20uaW5mby5jb2RlLAoJCQkJCQkJVmlkZW9UeXBlOiAgaW5mby5EYXRhLk1lc3NhZ2UuQW5zd2VyCgkJCQkJCX0sCgkJCQkJCXR5cGU6ICcnCgkJCQkJfTsKCQkJCQkKCQkJCQl0aGlzLm5vdGljZUV4LnNlbmQobXNnLnRvLCBtc2cuaW5mbyk7CgkJCQl9IGVsc2UgewoJCQkJCS8v5b2T5YmN55So5oi35LiN5Zyo5oi/6Ze0CgkJCQkJdGhpcy5jcmVhdGVSb29tKGluZm8pCgkJCQl9CgkJCX0pOwoJCQkvL+W9k+aIv+mXtOW3suW7uueriwoJCQl0aGlzLiRldmVuLiRvbigidXNlcl9yb29tX2NyZWF0ZSIsKGluZm8sbm90aWNlKT0+ewoJCQkJdmFyIG1zZyA9IHsKCQkJCQl0bzogaW5mby5Gcm9tLkd1aWQsCgkJCQkJaW5mbzogewoJCQkJCQlQbGF0ZTogbm90aWNlLmluZm8ucGxhdGUsCgkJCQkJCUNvZGU6IG5vdGljZS5pbmZvLmNvZGUsCgkJCQkJCVZpZGVvVHlwZTogaW5mby5EYXRhLk1lc3NhZ2UuQW5zd2VyLAoJCQkJCX0sCgkJCQkJdHlwZTogJycKCQkJCX07CQoJCQkJdGhpcy5ub3RpY2VFeC5zZW5kKG1zZy50bywgbXNnLmluZm8pOwoJCQl9KTsKCQkJLy/mlLbliLDliJvlu7rmiL/pl7TmjIfku6QKCQkJdGhpcy4kZXZlbi4kb24oIm5vdGljZV9yb29tX2J1aWxkIiwoaW5mbyk9PnsKCQkJCXRoaXMuY3JlYXRlUm9vbShpbmZvKQoJCQl9KTsKCQkJLy/mlLbliLDliqDlhaXmiL/pl7TmjIfku6QKCQkJdGhpcy4kZXZlbi4kb24oIm5vdGljZV9yb29tX2pvaW4iLChpbmZvKT0+ewoJCQkJdGhpcy5jcmVhdGVSdGNTZW5kZXIoaW5mby5EYXRhLkFjY2VwdC5HdWlkLCdkZXNrJykudGhlbigob2ZmZXIpPT57CgkJCQkJLy/lj5HpgIHmnKzlnLDkv6Hku6QKCQkJCQlsZXQgcnRjID0gdGhpcy51c2VyUnRjc1tpbmZvLkRhdGEuQWNjZXB0Lkd1aWRdLmRlc2s7CgkJCQkJcnRjLnJlYWR5ID0gKHRva2VuKT0+ewoJCQkJCQlsZXQgc2VuZE1zZyA9IHsKCQkJCQkJCXR5cGU6J3B1c2gnLAoJCQkJCQkJanNlcDpvZmZlciwKCQkJCQkJCXRva2VuOnJ0Yy5jYW5kaWRhdGUKCQkJCQkJfQoJCQkJCQl0aGlzLm5vdGljZVJvb20uc2VuZChpbmZvLkRhdGEuQWNjZXB0Lkd1aWQsIHNlbmRNc2cpOwoJCQkJCX0JCQkJCQoJCQkJfSkKCQkJfSk7CgkJCS8v5pS25Yiw6YCA5Ye65oi/6Ze05oyH5LukCgkJCXRoaXMuJGV2ZW4uJG9uKCJub3RpY2Vfcm9vbV9sZWF2ZSIsKGluZm8pPT57CgkJCQl0aGlzLiRub3RpZnkoewoJCQkJCXRpdGxlOiAn5o+Q56S6JywKCQkJCQltZXNzYWdlOiBpbmZvLkRhdGEuQWNjZXB0Lk5hbWUgKyAn6YCA5Ye66KeG6aKR77yBJywKCQkJCX0pOwoJCQkJdmFyIHJlbW92ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGluZm8uRGF0YS5BY2NlcHQuR3VpZCk7CgkJCQlyZW1vdmUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChyZW1vdmUpOwoJCQkJZGVsZXRlIHRoaXMudXNlclN0cmVhbXNbaW5mby5EYXRhLkFjY2VwdC5HdWlkXQoJCQl9KTsKCQkJLy/lvZPmlLbliLBwdXNo5raI5oGvCgkJCXRoaXMuJGV2ZW4uJG9uKCJub3RpY2VfY2hhbm5lbF9wdXNoIiwoaW5mbyk9PnsKCQkJCWxldCByZWMgPSBpbmZvLkRhdGEuTWVzc2FnZTsKCQkJCQoJCQkJdGhpcy5jcmVhdGVSdGNSZXZpY2UoaW5mby5Gcm9tLkd1aWQsJ2Rlc2snKS50aGVuKChydGMpPT57CgkJCQkJcnRjLmNyZWF0ZUFuc3dlcihyZWMuanNlcCkudGhlbigoYW5zd2VyKT0+ewoJCQkJCQkvL+W6lOetlOWvueaWueS/oeS7pAoJCQkJCQlydGMucmVhZHk9KHRva2VuKT0+ewoJCQkJCQkJbGV0IHNlbmRNc2cgPSB7CgkJCQkJCQkJCXR5cGU6J3N1YnNjcmliZScsCgkJCQkJCQkJCWpzZXA6YW5zd2VyLAoJCQkJCQkJCQl0b2tlbjpydGMuY2FuZGlkYXRlCgkJCQkJCQkJfQoJCQkJCQkJCXJ0Yy5hZGRJY2VDYW5kaWRhdGUocmVjLnRva2VuKTsKCQkJCQkJCQl0aGlzLm5vdGljZVJvb20uc2VuZChpbmZvLkZyb20uR3VpZCwgc2VuZE1zZyk7CgkJCQkJCX0KCQkJCQl9KQoJCQkJCXJ0Yy5yZWFkeSA9ICh0b2tlbik9PnsKCQkJCQkJbGV0IHNlbmRNc2cgPSB7CgkJCQkJCQl0eXBlOidyZWFkeScsCgkJCQkJCQl0b2tlbjp0b2tlbiwKCQkJCQkJfQoJCQkJCQl0aGlzLm5vdGljZVJvb20uc2VuZChpbmZvLkZyb20uR3VpZCwgc2VuZE1zZyk7CgkJCQkJfQoJCQkJfSkKCQkJfSk7CgkJCS8v5b2T5pS25Yiw6K6i6ZiF5raI5oGvCgkJCXRoaXMuJGV2ZW4uJG9uKCJub3RpY2VfY2hhbm5lbF9zdWJzY3JpYmUiLChpbmZvKT0+ewoJCQkJbGV0IHJlYyA9IGluZm8uRGF0YS5NZXNzYWdlOwoJCQkJbGV0IHJ0YyA9IHRoaXMudXNlclJ0Y3NbaW5mby5Gcm9tLkd1aWRdLmRlc2s7CgkJCQlydGMuc2V0UmVtb3RlKHJlYy5qc2VwKQoJCQkJcnRjLmFkZEljZUNhbmRpZGF0ZShyZWMudG9rZW4pOwoJCQl9KTsKCQl9Cgl9Cn0K"},{"version":3,"sources":["room.vue"],"names":[],"mappings":";;;;;;;;;;AAUA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"room.vue","sourceRoot":"pages/common","sourcesContent":["<template>\r\n\t<div>\r\n\t\t<el-card id=\"localStream\" style=\"display: inline-block;margin:10px\">\r\n\t\t</el-card>\r\n\t\t\r\n\t\t<videoElement v-for=\"(item,key,i) in userStreams\" :key=\"i\" :mid=\"key\" :stream=\"item\"></videoElement>\r\n\t</div>\n</template>\n\n<script>\r\n\timport videoElement from '@/pages/common/videoElement.vue'\r\n\timport NoticeSDK from '@/utils/noticeSDK/index.js'\r\n\timport RtcSDK from '@/utils/rtcSDK/rtc.js'\r\n\timport conf from '@/conf/conf.js'\r\n\timport {makeGuid} from '../../src/utils/makeGuid.js';\r\n\timport {mapState,mapMutations} from 'vuex'\r\n\timport notice from '@/utils/mixins/notice.js'\r\n\t\r\n\texport default {\r\n\t\tcomputed: {\r\n\t\t\t...mapState([\"uInfo\"]),\r\n\t\t\t...mapState([\"noticeRoom\"]),\r\n\t\t},\r\n\t\tmixins:[notice],\r\n\t\tdata(){\r\n\t\t\treturn {\r\n\t\t\t\tuserStreams:{},\r\n\t\t\t\tuserRtcs:{},\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods:{\r\n\t\t\tcheckMedia(){\r\n\t\t\t\treturn {\r\n\t\t\t\t\tmediaDevices:navigator != undefined && navigator.mediaDevices != undefined,\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tasync createLocalSteam() {\r\n\t\t\t\tif (!this.checkMedia().mediaDevices) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\treturn await navigator.mediaDevices.getUserMedia({\r\n\t\t\t\t\taudio: true,\r\n\t\t\t\t\tvideo: {\r\n\t\t\t\t\t\twidth: {\r\n\t\t\t\t\t\t\tideal: 1280\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\theight: {\r\n\t\t\t\t\t\t\tideal: 720\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tasync createRtcSender(uid, type) {\r\n\t\t\t\tlet that = this;\r\n\t\t\t\tlet rtc = new RtcSDK({\r\n\t\t\t\t\tserve: \"stun:stun.stunprotocol.org:3478\"\r\n\t\t\t\t});\r\n\t\t\t\t//rtc.sendOffer = false;\r\n\t\t\t\tif (this.checkMedia().mediaDevices) {\r\n\t\t\t\t\t//清空内容\r\n\t\t\t\t\tdocument.getElementById('localStream').innerHTML = \"\";\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet stream = await this.createLocalSteam();\r\n\t\t\t\t\tconst video = document.createElement('video');\r\n\t\t\t\t\tvideo.width = 300;\r\n\t\t\t\t\tvideo.height = 300;\r\n\t\t\t\t\tvideo.autoplay = true;\r\n\t\t\t\t\tvideo.playsinline = true;\r\n\t\t\t\t\tvideo.controls = true;\r\n\t\t\t\t\tvideo.srcObject = stream;\r\n\t\t\t\t\tlet parentElement = document.getElementById(\"localStream\");\r\n\t\t\t\t\tparentElement.appendChild(video);\r\n\t\t\t\t\t\r\n\t\t\t\t\trtc.addSteam(stream);\r\n\t\t\t\t}\r\n\t\t\t\r\n\t\t\t\trtc.join = (stream) => {\r\n\t\t\t\t\tthis.$set(that.userStreams, uid, stream.stream)\r\n\t\t\t\t}\r\n\t\t\t\tthis.setUserRtcs(rtc, uid, type);\r\n\t\t\t\treturn await rtc.createOffer({\r\n\t\t\t\t\tofferToReceiveVideo: true,\r\n\t\t\t\t\tofferToReceiveAudio: true\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tsetUserRtcs(rtc,uid,type){\r\n\t\t\t\tif(!this.userRtcs[uid]){\r\n\t\t\t\t\tthis.userRtcs[uid] = new Object();\r\n\t\t\t\t}\r\n\t\t\t\tthis.userRtcs[uid][type] = rtc;\t\r\n\t\t\t},\r\n\t\t\tcreateRoom(info){\r\n\t\t\t\t/*let offer = this.createRtcSender(info.Data.Accept.Guid,'desk');\r\n\t\t\t\tlet rtc = this.userRtcs[info.Data.Accept.Guid].desk;\r\n\t\t\t\trtc.ready = (token)=>{\r\n\t\t\t\t\tlet sendMsg = {\r\n\t\t\t\t\t\ttype:'push',\r\n\t\t\t\t\t\tjsep:offer,\r\n\t\t\t\t\t\ttoken:rtc.candidate\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.noticeRoom.send(info.Data.Accept.Guid, sendMsg);\r\n\t\t\t\t}*/\r\n\t\t\t\tthis.initRoom(info);\r\n\t\t\t},\r\n\t\t\tasync createRtcRevice(uid,type){\r\n\t\t\t\tlet that = this;\r\n\t\t\t\tlet rtc = new RtcSDK({serve:\"stun:stun.stunprotocol.org:3478\"});\r\n\t\t\t\t//rtc.socure.addTransceiver('audio', { 'direction': 'recvonly' });\r\n\t\t\t\t//rtc.socure.addTransceiver('video', { 'direction': 'recvonly' });\r\n\t\t\t\t//rtc.sendOffer = false;\r\n\t\t\t\tif(this.checkMedia().mediaDevices){\r\n\t\t\t\t\t//清空内容\r\n\t\t\t\t\tdocument.getElementById('localStream').innerHTML = \"\";\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet stream = await this.createLocalSteam();\r\n\t\t\t\t\tconst video = document.createElement('video');\r\n\t\t\t\t\tvideo.width = 300;\r\n\t\t\t\t\tvideo.height = 300;\r\n\t\t\t\t\tvideo.autoplay = true;\r\n\t\t\t\t\tvideo.playsinline = true;\r\n\t\t\t\t\tvideo.controls = false;\r\n\t\t\t\t\tvideo.srcObject = stream;\r\n\t\t\t\t\tlet parentElement = document.getElementById(\"localStream\");\r\n\t\t\t\t\tparentElement.appendChild(video);\r\n\t\t\t\t\trtc.addSteam(stream);\r\n\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\trtc.join=(stream)=>{\r\n\t\t\t\t\tconsole.log(\"in join\",stream)\r\n\t\t\t\t\tthis.$set(that.userStreams,uid,stream.stream)\r\n\t\t\t\t\t//that.userStreams[uid]=stream.stream;\r\n\t\t\t\t\tconsole.log(\"that\",that.userStreams)\r\n\t\t\t\t}\r\n\t\t\t\tthis.setUserRtcs(rtc,uid,type);\t\t\r\n\t\t\t\treturn await rtc;\r\n\t\t\t\t//return await rtc.createOffer({ offerToReceiveVideo: true, offerToReceiveAudio: true });\r\n\t\t\t},\r\n\t\t\tevens(){\r\n\t\t\t\t//当对方选择以视频方式接通时\r\n\t\t\t\tthis.$even.$on(\"notice_live_connectall\",(info)=>{\r\n\t\t\t\t\t//当前用户已在房间\r\n\t\t\t\t\tif(this.noticeRoom.info != undefined){\r\n\t\t\t\t\t\tvar msg = {\r\n\t\t\t\t\t\t\tto: info.From.Guid,\r\n\t\t\t\t\t\t\tinfo: {\r\n\t\t\t\t\t\t\t\tPlate: this.noticeRoom.info.plate,\r\n\t\t\t\t\t\t\t\tCode: this.noticeRoom.info.code,\r\n\t\t\t\t\t\t\t\tVideoType:  info.Data.Message.Answer\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\ttype: ''\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis.noticeEx.send(msg.to, msg.info);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t//当前用户不在房间\r\n\t\t\t\t\t\tthis.createRoom(info)\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t//当房间已建立\r\n\t\t\t\tthis.$even.$on(\"user_room_create\",(info,notice)=>{\r\n\t\t\t\t\tvar msg = {\r\n\t\t\t\t\t\tto: info.From.Guid,\r\n\t\t\t\t\t\tinfo: {\r\n\t\t\t\t\t\t\tPlate: notice.info.plate,\r\n\t\t\t\t\t\t\tCode: notice.info.code,\r\n\t\t\t\t\t\t\tVideoType: info.Data.Message.Answer,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\ttype: ''\r\n\t\t\t\t\t};\t\r\n\t\t\t\t\tthis.noticeEx.send(msg.to, msg.info);\r\n\t\t\t\t});\r\n\t\t\t\t//收到创建房间指令\r\n\t\t\t\tthis.$even.$on(\"notice_room_build\",(info)=>{\r\n\t\t\t\t\tthis.createRoom(info)\r\n\t\t\t\t});\r\n\t\t\t\t//收到加入房间指令\r\n\t\t\t\tthis.$even.$on(\"notice_room_join\",(info)=>{\r\n\t\t\t\t\tthis.createRtcSender(info.Data.Accept.Guid,'desk').then((offer)=>{\r\n\t\t\t\t\t\t//发送本地信令\r\n\t\t\t\t\t\tlet rtc = this.userRtcs[info.Data.Accept.Guid].desk;\r\n\t\t\t\t\t\trtc.ready = (token)=>{\r\n\t\t\t\t\t\t\tlet sendMsg = {\r\n\t\t\t\t\t\t\t\ttype:'push',\r\n\t\t\t\t\t\t\t\tjsep:offer,\r\n\t\t\t\t\t\t\t\ttoken:rtc.candidate\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis.noticeRoom.send(info.Data.Accept.Guid, sendMsg);\r\n\t\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t\t})\r\n\t\t\t\t});\r\n\t\t\t\t//收到退出房间指令\r\n\t\t\t\tthis.$even.$on(\"notice_room_leave\",(info)=>{\r\n\t\t\t\t\tthis.$notify({\r\n\t\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\t\tmessage: info.Data.Accept.Name + '退出视频！',\r\n\t\t\t\t\t});\r\n\t\t\t\t\tvar remove = document.getElementById(info.Data.Accept.Guid);\r\n\t\t\t\t\tremove.parentNode.removeChild(remove);\r\n\t\t\t\t\tdelete this.userStreams[info.Data.Accept.Guid]\r\n\t\t\t\t});\r\n\t\t\t\t//当收到push消息\r\n\t\t\t\tthis.$even.$on(\"notice_channel_push\",(info)=>{\r\n\t\t\t\t\tlet rec = info.Data.Message;\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.createRtcRevice(info.From.Guid,'desk').then((rtc)=>{\r\n\t\t\t\t\t\trtc.createAnswer(rec.jsep).then((answer)=>{\r\n\t\t\t\t\t\t\t//应答对方信令\r\n\t\t\t\t\t\t\trtc.ready=(token)=>{\r\n\t\t\t\t\t\t\t\tlet sendMsg = {\r\n\t\t\t\t\t\t\t\t\t\ttype:'subscribe',\r\n\t\t\t\t\t\t\t\t\t\tjsep:answer,\r\n\t\t\t\t\t\t\t\t\t\ttoken:rtc.candidate\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\trtc.addIceCandidate(rec.token);\r\n\t\t\t\t\t\t\t\t\tthis.noticeRoom.send(info.From.Guid, sendMsg);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\trtc.ready = (token)=>{\r\n\t\t\t\t\t\t\tlet sendMsg = {\r\n\t\t\t\t\t\t\t\ttype:'ready',\r\n\t\t\t\t\t\t\t\ttoken:token,\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis.noticeRoom.send(info.From.Guid, sendMsg);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t});\r\n\t\t\t\t//当收到订阅消息\r\n\t\t\t\tthis.$even.$on(\"notice_channel_subscribe\",(info)=>{\r\n\t\t\t\t\tlet rec = info.Data.Message;\r\n\t\t\t\t\tlet rtc = this.userRtcs[info.From.Guid].desk;\r\n\t\t\t\t\trtc.setRemote(rec.jsep)\r\n\t\t\t\t\trtc.addIceCandidate(rec.token);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\n</script>\n\n<style>\n</style>\n"]}]}