{"remainingRequest":"D:\\GaeaProject\\jpn_medical_web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\GaeaProject\\jpn_medical_web\\pages\\main\\index.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"D:\\GaeaProject\\jpn_medical_web\\pages\\main\\index.vue","mtime":1591846200097},{"path":"D:\\GaeaProject\\jpn_medical_web\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\GaeaProject\\jpn_medical_web\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\GaeaProject\\jpn_medical_web\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\GaeaProject\\jpn_medical_web\\node_modules\\sass-resources-loader\\lib\\loader.js","mtime":499162500000},{"path":"D:\\GaeaProject\\jpn_medical_web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\GaeaProject\\jpn_medical_web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouZWwtbWVudS12ZXJ0aWNhbDpub3QoLmVsLW1lbnUtLWNvbGxhcHNlKSB7Cgl3aWR0aDogMjAwcHg7CgltaW4taGVpZ2h0OiA4MDBweDsKfQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6ZA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"pages/main","sourcesContent":["<template>\r\n\t<el-container>\r\n\t\t<el-aside style=\"width:auto;padding-top:60px\">\r\n\t\t\t<el-menu router class=\"el-menu-vertical\" :collapse=\"isCollapse\">\r\n\t\t\t\t<el-menu-item index=\"/main/patients\">\r\n\t\t\t\t\t<i class=\"el-icon-user\"></i>\r\n\t\t\t\t\t<span slot=\"title\">{{ $t(\"default.NAV.PATIENTS\") }}</span>\r\n\t\t\t\t</el-menu-item>\r\n\t\t\t\t<el-menu-item index=\"/main/appointment\">\r\n\t\t\t\t\t<i class=\"el-icon-watch\"></i>\r\n\t\t\t\t\t<span slot=\"title\">{{ $t(\"default.NAV.APPOINTMENT\") }}</span>\r\n\t\t\t\t</el-menu-item>\r\n\t\t\t\t<el-menu-item index=\"/main/departent\">\r\n\t\t\t\t\t<i class=\"el-icon-suitcase-1\"></i>\r\n\t\t\t\t\t<span slot=\"title\">{{ $t(\"default.NAV.DEPARTMENT\") }}</span>\r\n\t\t\t\t</el-menu-item>\r\n\t\t\t\t<el-menu-item @click=\"isCollapse = !isCollapse\">\r\n\t\t\t\t\t<div style=\"text-align: right;\">\r\n\t\t\t\t\t\t<transition name=\"el-fade-in-linear\">\r\n\t\t\t\t\t\t\t<i v-if=\"isCollapse\" class=\"el-icon-menu\"></i>\r\n\t\t\t\t\t\t\t<i v-if=\"!isCollapse\" class=\"el-icon-s-grid\"></i>\r\n\t\t\t\t\t\t</transition>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</el-menu-item>\r\n\t\t\t</el-menu>\r\n\t\t</el-aside>\r\n\t\t<el-container>\r\n\t\t\t<el-header>\r\n\t\t\t\t<el-menu class=\"el-menu-demo\" mode=\"horizontal\" @select=\"handleSelect\">\r\n\t\t\t\t\t<el-submenu index=\"2\" style=\"float: right;\">\r\n\t\t\t\t\t\t<template slot=\"title\">\r\n\t\t\t\t\t\t\t<el-avatar size=\"small\" src=\"http://img2.imgtn.bdimg.com/it/u=2421351453,1852348871&fm=26&gp=0.jpg\"></el-avatar>\r\n\t\t\t\t\t\t\t{{ uInfo.UserName }}\r\n\t\t\t\t\t\t</template>\r\n\t\t\t\t\t\t<el-menu-item index=\"2-1\">{{ $t(\"default.INFOS.INFO\")}}</el-menu-item>\r\n\t\t\t\t\t\t<el-menu-item index=\"2-3\">{{ $t(\"default.BASIC.LOGIN_OUT\")}}</el-menu-item>\r\n\t\t\t\t\t</el-submenu>\r\n\t\t\t\t\t<el-submenu index=\"1\" style=\"float: right;\">\r\n\t\t\t\t\t\t<template slot=\"title\">{{ $t(\"default.EVENTS.SWITCH_LANGUAGES\")}}</template>\r\n\t\t\t\t\t\t<el-menu-item @click=\"switchLanguaes('zh-CN')\" index=\"1-1\">简体中文</el-menu-item>\r\n\t\t\t\t\t\t<el-menu-item index=\"1-2\">English</el-menu-item>\r\n\t\t\t\t\t\t<el-menu-item @click=\"switchLanguaes('ja-JP')\" index=\"1-3\">日本語</el-menu-item>\r\n\t\t\t\t\t</el-submenu>\r\n\t\t\t\t</el-menu>\r\n\t\t\t</el-header>\r\n\t\t\t<el-main>\r\n\t\t\t\t<breadcrumb style=\"margin-bottom:15px\"></breadcrumb>\r\n\t\t\t\t<router-view></router-view>\r\n\t\t\t</el-main>\r\n\t\t</el-container>\r\n\t\t<!-- video -->\r\n\t\t<live @close=\"closeRoom\" :message=\"message\" :userStreams=\"userStreams\"></live>\r\n\t</el-container>\r\n</template>\r\n\r\n<script>\r\n\timport breadcrumb from '@/src/components/breadcrumb.vue';\r\n\timport {\r\n\t\tmapState,\r\n\t\tmapMutations\r\n\t} from 'vuex'\r\n\timport live from '@/pages/common/live.vue'\r\n\r\n\timport NoticeSDK from '../../utils/noticeSDK/index.js'\r\n\timport RtcSDK from '../../utils/rtcSDK/rtc.js'\r\n\timport conf from '@/conf/conf.js'\r\n\t\r\n\timport {\r\n\t\tmakeGuid\r\n\t} from '../../src/utils/makeGuid.js';\r\n\r\n\tvar common = function() {\r\n\t\treturn {\r\n\t\t\tplate: 'jpn_plate',\r\n\t\t\tcode: \"079498\",\r\n\t\t}\r\n\t}\r\n\r\n\texport default {\r\n\t\tcomponents: {\r\n\t\t\tbreadcrumb,\r\n\t\t\tlive\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\t...mapState([\"uInfo\"]),\r\n\t\t\t...mapState([\"noticeEx\"]),\r\n\t\t\t...mapState([\"noticeRoom\"]),\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tisCollapse: false,\r\n\t\t\t\tmessage: null,\r\n\t\t\t\t\r\n\t\t\t\tcanMedia:true,\r\n\t\t\t\tloacalSteam:new MediaStream(),\r\n\t\t\t\tuserRtcs:{},\r\n\t\t\t\tuserStreams:{},\r\n\t\t\t\ttokens:{},\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t...mapMutations([\"update\"]),\r\n\t\t\tswitchLanguaes(e) {\r\n\t\t\t\tthis.$i18n.locale = e;\r\n\t\t\t},\r\n\t\t\thandleSelect(e, keypath) {\r\n\t\t\t\tif (e == 1) {\r\n\t\t\t\t\t//this.isCollapse = !this.isCollapse;\r\n\t\t\t\t}\r\n\t\t\t},\t\t\t\r\n\t\t\tinitNotice(plate, init) {\r\n\t\t\t\tvar that = this;\r\n\t\t\t\tvar params = {\r\n\t\t\t\t\tserve: conf.getCurrentServe().notice.area,\r\n\t\t\t\t\tplate: plate.plate,\r\n\t\t\t\t\tname: this.uInfo.UserName,\r\n\t\t\t\t\tuser: this.uInfo.UserGuid,\r\n\t\t\t\t\tcode: plate.code,\r\n\t\t\t\t\tisTTL: conf.getCurrentServe().type == \"TTL\"\r\n\t\t\t\t}\r\n\t\t\t\tvar notice = new NoticeSDK(params);\r\n\t\t\t\tif (init) {\r\n\t\t\t\t\tthis.update({\r\n\t\t\t\t\t\tnoticeEx: notice\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.noticeEx.complate().then(() => {\r\n\t\t\t\t\t\tthat.update({\r\n\t\t\t\t\t\t\tnotice: that.noticeEx\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.noticeEx.message = function(info) {\r\n\t\t\t\t\t\tif (info.Type === \"sys\") {\r\n\t\t\t\t\t\t\tinfo.Data.Message = JSON.parse(info.Data.Message)\r\n\t\t\t\t\t\t\tif (info.Data.Message == \"JOIN\") {\r\n\t\t\t\t\t\t\t\t//that.message = info\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (info.Type === \"info\") {\r\n\t\t\t\t\t\t\tinfo.Data.Message = JSON.parse(info.Data.Message);\r\n\t\t\t\t\t\t\tif (info.Data.Message.Creater == 1) { //获得邀请\r\n\t\t\t\t\t\t\t\tthat.message = info;\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (info.Data.Message.Answer != undefined) { //获得回复\r\n\t\t\t\t\t\t\t\tvar Answer = info.Data.Message.Answer;\r\n\t\t\t\t\t\t\t\tif (Answer == '001') { //挂断处理\r\n\t\t\t\t\t\t\t\t\tthat.$notify({\r\n\t\t\t\t\t\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\t\t\t\t\t\tmessage: '对方已挂断!',\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (Answer == '002') { //邀请者视频中的处理\r\n\t\t\t\t\t\t\t\t\tthat.$notify({\r\n\t\t\t\t\t\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\t\t\t\t\t\tmessage: '对方正在视频中！',\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (that.noticeRoom.info != undefined) { //当前在房间中，直接发房间信息给被邀请人\r\n\t\t\t\t\t\t\t\t\tvar msg = {\r\n\t\t\t\t\t\t\t\t\t\tto: info.From.Guid,\r\n\t\t\t\t\t\t\t\t\t\tinfo: {\r\n\t\t\t\t\t\t\t\t\t\t\tPlate: that.noticeRoom.info.plate,\r\n\t\t\t\t\t\t\t\t\t\t\tCode: that.noticeRoom.info.code,\r\n\t\t\t\t\t\t\t\t\t\t\tVideoType: Answer\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\ttype: ''\r\n\t\t\t\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t\t\t\tthat.noticeEx.send(msg.to, msg.info);\r\n\t\t\t\t\t\t\t\t} else { //不在房间的处理-创建房间并发送房间信息给被邀请人\r\n\t\t\t\t\t\t\t\t\tthat.createRoom(info)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (info.Data.Message.Plate != undefined && info.Data.Message.Code != undefined) { //获得房间和code\r\n\t\t\t\t\t\t\t\tthat.initNotice({\r\n\t\t\t\t\t\t\t\t\tplate: info.Data.Message.Plate,\r\n\t\t\t\t\t\t\t\t\tcode: info.Data.Message.Code,\r\n\t\t\t\t\t\t\t\t}, false)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t};\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.update({\r\n\t\t\t\t\t\tnoticeRoom: notice\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.noticeRoom.message = function(info) {\r\n\t\t\t\t\t\tif (info.Type === \"sys\") {\r\n\t\t\t\t\t\t\tinfo.Data.Message = JSON.parse(info.Data.Message)\r\n\t\t\t\t\t\t\tif (info.Data.Message.Message == \"LEAVE\") {\r\n\t\t\t\t\t\t\t\tthat.$notify({\r\n\t\t\t\t\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\t\t\t\t\tmessage: info.Data.Accept.Name + '退出视频！',\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tvar remove = document.getElementById(info.Data.Accept.Guid);\r\n\t\t\t\t\t\t\t\tremove.parentNode.removeChild(remove);\r\n\t\t\t\t\t\t\t\t//document.getElementById(info.Data.Accept.Guid).innerHTML = \"\";\t\t\r\n\t\t\t\t\t\t\t\t//that.userStreams[info.Data.Accept.Guid] = null;\r\n\t\t\t\t\t\t\t\tdelete that.userStreams[info.Data.Accept.Guid]\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(info.Data.Message.Message == \"JOIN\"){\r\n\t\t\t\t\t\t\t\t//return;\r\n\t\t\t\t\t\t\t\tthat.createRtcSender(info.Data.Accept.Guid,'desk').then((offer)=>{\r\n\t\t\t\t\t\t\t\t\t//发送本地信令\r\n\t\t\t\t\t\t\t\t\tlet rtc = that.userRtcs[info.Data.Accept.Guid].desk;\r\n\t\t\t\t\t\t\t\t\trtc.ready = (token)=>{\r\n\t\t\t\t\t\t\t\t\t\tlet sendMsg = {\r\n\t\t\t\t\t\t\t\t\t\t\ttype:'push',\r\n\t\t\t\t\t\t\t\t\t\t\tjsep:offer,\r\n\t\t\t\t\t\t\t\t\t\t\ttoken:rtc.candidate\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tthat.noticeRoom.send(info.Data.Accept.Guid, sendMsg);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (info.Type === \"info\") {\r\n\t\t\t\t\t\t\tinfo.Data.Message = JSON.parse(info.Data.Message);\r\n\t\t\t\t\t\t\tif(info.Data.Message.type == 'push'){\r\n\t\t\t\t\t\t\t\tlet rec = info.Data.Message;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthat.createRtcRevice(info.From.Guid,'desk').then((rtc)=>{\r\n\t\t\t\t\t\t\t\t\trtc.createAnswer(rec.jsep).then((answer)=>{\r\n\t\t\t\t\t\t\t\t\t\t//应答对方信令\r\n\t\t\t\t\t\t\t\t\t\trtc.ready=(token)=>{\r\n\t\t\t\t\t\t\t\t\t\t\tlet sendMsg = {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype:'subscribe',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tjsep:answer,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttoken:rtc.candidate\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\trtc.addIceCandidate(rec.token);\r\n\t\t\t\t\t\t\t\t\t\t\t\tthat.noticeRoom.send(info.From.Guid, sendMsg);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\trtc.ready = (token)=>{\r\n\t\t\t\t\t\t\t\t\t\tconsole.log(\"token is:\",token)\r\n\t\t\t\t\t\t\t\t\t\tlet sendMsg = {\r\n\t\t\t\t\t\t\t\t\t\t\ttype:'ready',\r\n\t\t\t\t\t\t\t\t\t\t\ttoken:token,\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tthat.noticeRoom.send(info.From.Guid, sendMsg);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(info.Data.Message.type == 'subscribe'){\r\n\t\t\t\t\t\t\t\tlet rec = info.Data.Message;\r\n\t\t\t\t\t\t\t\tlet rtc = that.userRtcs[info.From.Guid].desk;\r\n\t\t\t\t\t\t\t\t//console.log(\"subscribetoken\",rec.token)\r\n\t\t\t\t\t\t\t\t//console.log(rtc)\r\n\t\t\t\t\t\t\t\trtc.setRemote(rec.jsep)\r\n\t\t\t\t\t\t\t\trtc.addIceCandidate(rec.token);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\t\t\tcreateRoom(data) {\r\n\t\t\t\tvar that = this;\r\n\t\t\t\tvar status = data.Data.Message.Answer;\r\n\t\t\t\tvar roomGuid = makeGuid();\r\n\t\t\t\tlet params = {\r\n\t\t\t\t\tserve: conf.getCurrentServe().notice.area,\r\n\t\t\t\t\tplate: roomGuid,\r\n\t\t\t\t\tname: this.uInfo.UserName,\r\n\t\t\t\t\tuser: this.uInfo.UserGuid,\r\n\t\t\t\t\tisTTL: conf.getCurrentServe().type == \"TTL\"\r\n\t\t\t\t}\r\n\t\t\t\tvar notice = new NoticeSDK(params)\r\n\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\tthat.initNotice({\r\n\t\t\t\t\t\tplate: notice.info.plate,\r\n\t\t\t\t\t\tcode: notice.info.code\r\n\t\t\t\t\t}, false);\r\n\t\t\t\t\tvar msg = {\r\n\t\t\t\t\t\tto: data.From.Guid,\r\n\t\t\t\t\t\tinfo: {\r\n\t\t\t\t\t\t\tPlate: notice.info.plate,\r\n\t\t\t\t\t\t\tCode: notice.info.code,\r\n\t\t\t\t\t\t\tVideoType: status\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\ttype: ''\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tthat.noticeEx.send(msg.to, msg.info);\r\n\t\t\t\t\treturn\r\n\t\t\t\t\tthat.createRtcSender(data.From.Guid,'desk').then((offer)=>{\r\n\t\t\t\t\t\t//发送本地信令\r\n\t\t\t\t\t\tlet rtc = that.userRtcs[data.From.Guid].desk;\r\n\t\t\t\t\t\trtc.ready = (token)=>{\r\n\t\t\t\t\t\t\tlet sendMsg = {\r\n\t\t\t\t\t\t\t\ttype:'push',\r\n\t\t\t\t\t\t\t\tjsep:offer,\r\n\t\t\t\t\t\t\t\ttoken:rtc.candidate\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthat.noticeRoom.send(data.From.Guid, sendMsg);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t})\r\n\t\t\t\t\t\r\n\t\t\t\t}, 1500)\r\n\t\t\t},\r\n\t\t\tcloseRoom(){\r\n\t\t\t\tthis.userStreams = {};\r\n\t\t\t},\r\n\t\t\tasync createRtcRevice(uid,type){\r\n\t\t\t\tlet that = this;\r\n\t\t\t\tlet rtc = new RtcSDK({serve:\"stun:stun.stunprotocol.org:3478\"});\r\n\t\t\t\t//rtc.socure.addTransceiver('audio', { 'direction': 'recvonly' });\r\n\t\t\t\t//rtc.socure.addTransceiver('video', { 'direction': 'recvonly' });\r\n\t\t\t\t//rtc.sendOffer = false;\r\n\t\t\t\tif(this.canMedia){\r\n\t\t\t\t\t//清空内容\r\n\t\t\t\t\tdocument.getElementById('test').innerHTML = \"\";\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet stream = await this.createLocalSteam();\r\n\t\t\t\t\tconst video = document.createElement('video');\r\n\t\t\t\t\tvideo.width = 300;\r\n\t\t\t\t\tvideo.height = 300;\r\n\t\t\t\t\tvideo.autoplay = true;\r\n\t\t\t\t\tvideo.playsinline = true;\r\n\t\t\t\t\tvideo.controls = false;\r\n\t\t\t\t\tvideo.srcObject = stream;\r\n\t\t\t\t\tlet parentElement = document.getElementById(\"test\");\r\n\t\t\t\t\tparentElement.appendChild(video);\r\n\t\t\t\t\trtc.addSteam(stream);\r\n\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\trtc.join=(stream)=>{\r\n\t\t\t\t\tconsole.log(\"in join\",stream)\r\n\t\t\t\t\tthis.$set(that.userStreams,uid,stream.stream)\r\n\t\t\t\t\t//that.userStreams[uid]=stream.stream;\r\n\t\t\t\t\tconsole.log(\"that\",that.userStreams)\r\n\t\t\t\t}\r\n\t\t\t\tthis.setUserRtcs(rtc,uid,type);\t\t\r\n\t\t\t\treturn await rtc;\r\n\t\t\t\t//return await rtc.createOffer({ offerToReceiveVideo: true, offerToReceiveAudio: true });\r\n\t\t\t},\r\n\t\t\tsetUserRtcs(rtc,uid,type){\r\n\t\t\t\tif(!this.userRtcs[uid]){\r\n\t\t\t\t\tthis.userRtcs[uid] = new Object();\r\n\t\t\t\t}\r\n\t\t\t\tthis.userRtcs[uid][type] = rtc;\t\r\n\t\t\t},\r\n\t\t\tasync createRtcSender(uid, type) {\r\n\t\t\t\tlet that = this;\r\n\t\t\t\tlet rtc = new RtcSDK({\r\n\t\t\t\t\tserve: \"stun:stun.stunprotocol.org:3478\"\r\n\t\t\t\t});\r\n\t\t\t\t//rtc.sendOffer = false;\r\n\t\t\t\tif (this.canMedia) {\r\n\t\t\t\t\t//清空内容\r\n\t\t\t\t\tdocument.getElementById('test').innerHTML = \"\";\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet stream = await this.createLocalSteam();\r\n\t\t\t\t\tconst video = document.createElement('video');\r\n\t\t\t\t\tvideo.width = 300;\r\n\t\t\t\t\tvideo.height = 300;\r\n\t\t\t\t\tvideo.autoplay = true;\r\n\t\t\t\t\tvideo.playsinline = true;\r\n\t\t\t\t\tvideo.controls = true;\r\n\t\t\t\t\tvideo.srcObject = stream;\r\n\t\t\t\t\tlet parentElement = document.getElementById(\"test\");\r\n\t\t\t\t\tparentElement.appendChild(video);\r\n\t\t\t\t\t\r\n\t\t\t\t\trtc.addSteam(stream);\r\n\t\t\t\t}\r\n\t\t\t\r\n\t\t\t\trtc.join = (stream) => {\r\n\t\t\t\t\tconsole.log(\"in join\", stream)\r\n\t\t\t\t\tthis.$set(that.userStreams, uid, stream.stream)\r\n\t\t\t\t\tconsole.log(\"that\", that.userStreams)\r\n\t\t\t\t}\r\n\t\t\t\tthis.setUserRtcs(rtc, uid, type);\r\n\t\t\t\treturn await rtc.createOffer({\r\n\t\t\t\t\tofferToReceiveVideo: true,\r\n\t\t\t\t\tofferToReceiveAudio: true\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tasync createLocalSteam() {\r\n\t\t\t\tlet that = this;\r\n\t\t\t\tif (!navigator.mediaDevices) {\r\n\t\t\t\t\tthis.canMedia = false;\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\treturn await navigator.mediaDevices.getUserMedia({\r\n\t\t\t\t\taudio: true,\r\n\t\t\t\t\tvideo: {\r\n\t\t\t\t\t\twidth: {\r\n\t\t\t\t\t\t\tideal: 1280\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\theight: {\r\n\t\t\t\t\t\t\tideal: 720\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t},\r\n\t\tmounted() {\r\n\t\t\t/*this.initNotice(common(), true);\r\n\t\t\tthis.update({\r\n\t\t\t\tnoticeRoom: {}\r\n\t\t\t});*/\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t.el-menu-vertical:not(.el-menu--collapse) {\r\n\t\twidth: 200px;\r\n\t\tmin-height: 800px;\r\n\t}\r\n</style>\r\n"]}]}